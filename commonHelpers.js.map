{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\n\nconst galleryContainer = document.querySelector('.gallery');\nconst searchForm = document.querySelector('.search-form');\nconst loaderContainer = document.querySelector('.loader');\nlet loadMoreBtn;\nconst GALLERY_LINK = 'gallery-link';\n\nlet currentPage = 1;\nlet searchQuery = '';\nlet totalHits = 0;\n\nloaderContainer.style.display = 'none';\n\nconst lightbox = new SimpleLightbox(`.${GALLERY_LINK}`);\n\nsearchForm.addEventListener('submit', async function (event) {\n  event.preventDefault();\n  searchQuery = event.target.elements.search.value.trim();\n\n  if (searchQuery === '') {\n    return;\n  }\n\n  currentPage = 1;\n  galleryContainer.innerHTML = '';\n  loaderContainer.style.display = 'block';\n\n  try {\n    const { data } = await fetchImages(searchQuery, currentPage);\n    const { hits, total } = data;\n    totalHits = total;\n\n    if (hits.length > 0) {\n      const galleryHTML = hits.map(createGallery).join('');\n      galleryContainer.innerHTML = galleryHTML;\n      toastSuccess(`Was found: ${totalHits} images`);\n      searchForm.reset();\n      lightbox.refresh();\n\n      checkEndOfResults();\n    } else {\n      toastError('Sorry, there are no images matching your search query. Please try again!');\n    }\n  } catch (error) {\n    toastError(`Error fetching images: ${error}`);\n  } finally {\n    loaderContainer.style.display = 'none';\n  }\n});\n\nfunction createLoadMoreButton() {\n  loadMoreBtn = document.createElement('button');\n  loadMoreBtn.classList.add('load-more-btn');\n  loadMoreBtn.textContent = 'Load more';\n  galleryContainer.after(loadMoreBtn);\n\n  loadMoreBtn.addEventListener('click', loadMoreImages);\n}\n\nfunction loadMoreImages() {\n  loaderContainer.style.display = 'block';\n  currentPage++;\n\n  try {\n    fetchImages(searchQuery, currentPage)\n      .then(({ data }) => {\n        const { hits } = data;\n\n        if (hits.length > 0) {\n          const galleryHTML = hits.map(createGallery).join('');\n          galleryContainer.innerHTML += galleryHTML;\n          lightbox.refresh();\n\n          checkEndOfResults();\n          scrollToBottom();\n        } else {\n          checkEndOfResults();\n        }\n      })\n      .catch(error => {\n        toastError(`Error fetching more images: ${error}`);\n      })\n      .finally(() => {\n        loaderContainer.style.display = 'none';\n      });\n  } catch (error) {\n    toastError(`Error fetching more images: ${error}`);\n    loaderContainer.style.display = 'none';\n  }\n}\n\nconst toastOptions = {\n  titleColor: '#FFFFFF',\n  messageColor: '#FFFFFF',\n  messageSize: '16px',\n  position: 'topRight',\n  displayMode: 'replace',\n  closeOnEscape: true,\n  pauseOnHover: false,\n  maxWidth: 432,\n  messageLineHeight: '24px',\n};\n\nfunction toastError(message) {\n  iziToast.show({\n    message,\n    backgroundColor: '#EF4040',\n    progressBarColor: '#FFE0AC',\n    icon: 'icon-close',\n    ...toastOptions,\n  });\n}\n\nfunction toastSuccess(message) {\n  iziToast.show({\n    message,\n    backgroundColor: '#59A10D',\n    progressBarColor: '#B5EA7C',\n    icon: 'icon-check',\n    ...toastOptions,\n  });\n}\n\nfunction checkEndOfResults() {\n  const totalDisplayed = document.querySelectorAll('.gallery-image').length;\n  if (totalDisplayed >= totalHits) {\n    if (loadMoreBtn) {\n      loadMoreBtn.style.display = 'none';\n    }\n    toastSuccess(\"We're sorry, but you've reached the end of search results.\");\n  } else {\n    if (!loadMoreBtn) {\n      createLoadMoreButton();\n    }\n  }\n}\n\nfunction scrollToBottom() {\n  const lastGalleryItem = galleryContainer.lastElementChild;\n  window.scrollTo({\n    top: lastGalleryItem.offsetTop + lastGalleryItem.offsetHeight,\n    behavior: 'smooth',\n  });\n}\n\nconst BASE_URL = 'https://pixabay.com/api/';\n\nasync function fetchImages(q, page) {\n  const params = new URLSearchParams({\n    key: '42205340-8125de1ae06f98e0344d3d2b5',\n    q,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page,\n    per_page: 15,\n  });\n\n  const url = `${BASE_URL}?${params}`;\n  return axios.get(url);\n}\n\nfunction createGallery({\n  largeImageURL,\n  tags,\n  webformatURL,\n  likes,\n  views,\n  comments,\n  downloads,\n}) {\n  return `\n  <a href=\"${largeImageURL}\" class=\"${GALLERY_LINK}\">\n    <figure>\n      <img src=\"${webformatURL}\" alt=\"${tags}\" class=\"gallery-image\">\n      <figcaption class=\"gallery__figcaption\">\n        <div class=\"image-item\">Likes <span class=\"image-elem\">${likes}</span></div>\n        <div class=\"image-item\">Views <span class=\"image-elem\">${views}</span></div>\n        <div class=\"image-item\">Comments <span class=\"image-elem\">${comments}</span></div>\n        <div class=\"image-item\">Downloads <span class=\"image-elem\">${downloads}</span></div>\n      </figcaption>\n    </figure>\n  </a>\n`;\n}\n"],"names":["galleryContainer","searchForm","loaderContainer","loadMoreBtn","GALLERY_LINK","currentPage","searchQuery","totalHits","lightbox","SimpleLightbox","event","data","fetchImages","hits","total","galleryHTML","createGallery","toastSuccess","checkEndOfResults","toastError","error","createLoadMoreButton","loadMoreImages","scrollToBottom","toastOptions","message","iziToast","lastGalleryItem","BASE_URL","q","page","params","url","axios","largeImageURL","tags","webformatURL","likes","views","comments","downloads"],"mappings":"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"}